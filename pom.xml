<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

    <modelVersion>4.0.0</modelVersion>
    <groupId>pentaho</groupId>
    <artifactId>mondrian</artifactId>
    <packaging>jar</packaging>
    <version>4.0.0-SNAPSHOT</version>
    <url>http://mondrian.pentaho.com</url>

    <build>
        <sourceDirectory>${project.basedir}/src/main</sourceDirectory>
        <testSourceDirectory>${project.basedir}/testsrc/main</testSourceDirectory>

        <plugins>
            <plugin>
                <groupId>pentaho</groupId>
                <artifactId>propertyutil-maven-plugin</artifactId>
                <version>0.1-SNAPSHOT</version>
                <executions>
                    <execution>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>generate</goal>
                        </goals>
                        <configuration>
                            <xmlFile>${project.build.sourceDirectory}/mondrian/olap/MondrianProperties.xml</xmlFile>
                            <javaFile>${project.build.directory}/generated-sources/propertyutil/mondrian/olap/MondrianProperties.java</javaFile>
                            <htmlFile>${project.build.directory}/doc</htmlFile>
                            <propertiesFile>mondrian.properties.template</propertiesFile>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>javacc-maven-plugin</artifactId>
                <version>2.6</version>
                <executions>
                    <execution>
                        <id>javacc</id>
                        <goals>
                            <goal>javacc</goal>
                        </goals>
                        <configuration>
                            <sourceDirectory>${project.basedir}/src/main</sourceDirectory>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <artifactId>maven-antrun-plugin</artifactId>
                <version>1.7</version>
                <executions>
                    <execution>
                        <phase>generate-sources</phase>
                        <configuration>
                            <target>
                                <loadproperties>
                                    <file file="build.properties"/>
                                </loadproperties>


                                <taskdef name="xomgen" classname="org.eigenbase.xom.XOMGenTask">

                                </taskdef>

                                <taskdef name="resgen" classname="org.eigenbase.resgen.ResourceGenTask"  classpathref="maven.plugin.classpath">

                                </taskdef>

                                <resgen
                                        srcdir="${project.build.sourceDirectory}"
                                        resdir="${project.build.directory}/generated-resources/resgen"
                                        style="functor"
                                        locales="en_US,de_DE,de,es_ES">
                                    <include name="mondrian/resource/MondrianResource.xml"/>
                                </resgen>


                                <!-- Ick... directories here seem to have to be relative. -->
                                <mkdir dir="${project.build.directory}/generated-sources/xom"/>
                                <touch file="${project.build.directory}/generated-sources/xom/mondrian/olap/mondrian3.dtd"
                                       mkdirs="true"/>
                                <touch file="${project.build.directory}/generated-sources/xom/mondrian/olap/mondrian.dtd"
                                       mkdirs="true"/>
                                <touch file="${project.build.directory}/generated-sources/xom/mondrian/rolap/aggmatcher/aggregates.dtd"
                                       mkdirs="true"/>
                                <touch file="${project.build.directory}/generated-sources/xom/mondrian/olap/mondrian3.dtd"
                                       mkdirs="true"/>

                                <echo message="0"/>
                                <xomgen
                                        model="src/main/mondrian/olap/Mondrian3Schema.xml"
                                        destdir="target/generated-sources/xom"
                                        classname="mondrian.olap.Mondrian3Def"
                                        dtdname="mondrian3.dtd"/>

                                <echo message="1"/>
                                <xomgen
                                        model="src/main/mondrian/olap/MondrianSchema.xml"
                                        destdir="target/generated-sources/xom"
                                        classname="mondrian.olap.MondrianDef"
                                        dtdname="mondrian.dtd"/>

                                <echo message="2"/>
                                <xomgen
                                        model="src/main/mondrian/rolap/aggmatcher/DefaultRulesSchema.xml"
                                        destdir="target/generated-sources/xom"
                                        classname="mondrian.rolap.aggmatcher.DefaultDef"
                                        dtdname="aggregates.dtd"/>

                                <echo message="3"/>
                                <xomgen
                                        model="src/main/mondrian/xmla/DataSourcesConfig.xml"
                                        destdir="target/generated-sources/xom"
                                        classname="mondrian.xmla.DataSourcesConfig"
                                        dtdname="datasourcesconfig.dtd"/>

                                <echo message="4"/>

                                <exec executable="git" outputproperty="git.commit">
                                    <arg line="log -n 1 --format=format:%H"/>
                                </exec>
                                <tstamp>
                                    <format property="build.time" timezone="UTC" pattern="yyyy/MM/dd HH:mm:ss z"/>
                                </tstamp>
                                <echo file="VERSION.txt">Title: ${name}
                                    Version: ${project.revision}
                                    VersionMajor: ${project.revision.major}
                                    VersionMinor: ${project.revision.minor}
                                    Vendor: ${vendor}
                                    Git-Latest-Commit: ${git.commit}
                                    Ant-Version: ${ant.version}
                                    Created-By: ${java.version} (${java.vendor})
                                    Built-On: ${build.time}
                                    Built-By: ${user.name}
                                    Built-In: ${user.dir}
                                </echo>
                                <echo file="${project.build.directory}/generated-sources/version/mondrian/olap4j/MondrianOlap4jDriverVersion.java">/*
                                    * Project version information. Generated - do not modify.
                                    */
                                    package mondrian.olap4j;
                                    /**
                                    * Version information for the Mondrian olap4j driver. (Generated.)
                                    */
                                    class MondrianOlap4jDriverVersion {
                                    static final String NAME = "${driver.name}";
                                    static final String VERSION = "${driver.version}";
                                    static final int MAJOR_VERSION = ${driver.version.major};
                                    static final int MINOR_VERSION = ${driver.version.minor};
                                    static final String GIT_LATEST_COMMIT =
                                    "${git.commit}";
                                    }

                                    // End MondrianOlap4jDriverVersion.java</echo>
                            </target>
                        </configuration>
                        <goals>
                            <goal>run</goal>
                        </goals>
                    </execution>
                </executions>
                <dependencies>
                   <dependency>
                      <groupId>pentaho</groupId>
                      <artifactId>mondrian-errors</artifactId>
                      <version>${project.version}</version>
                    </dependency>
                    
                    <dependency>
                        <groupId>eigenbase</groupId>
                        <artifactId>eigenbase-xom</artifactId>
                        <version>1.3.1</version>

                    </dependency>
                    <dependency>
                        <groupId>eigenbase</groupId>
                        <artifactId>eigenbase-properties</artifactId>
                        <version>1.1.2</version>

                    </dependency>
                    <dependency>
                        <groupId>eigenbase</groupId>
                        <artifactId>eigenbase-resgen</artifactId>
                        <version>1.3.1</version>

                    </dependency>
                </dependencies>
            </plugin>

            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>build-helper-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <id>add-source</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>add-source</goal>
                        </goals>
                        <configuration>
                            <sources>

                                <source>${project.build.directory}/generated-sources/xom</source>
                                <source>${project.build.directory}/generated-sources/propertyutil</source>
                                <source>${project.build.directory}/generated-sources/version</source>
                            </sources>
                        </configuration>
                    </execution>
                    <execution>
                        <id>add-resource</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>add-resource</goal>
                        </goals>
                        <configuration>
                            <resources>
                                <resource>
                                    <directory>${project.build.directory}/generated-resources/resgen</directory>
                                </resource>
                            </resources>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.0</version>
                <configuration>
                    <source>1.6</source>
                    <target>1.6</target>
                    <encoding>UTF-8</encoding>
                    <fork>true</fork>
                    <excludes>
                        <exclude>mondrian/olap4j/FactoryJdbc3Impl.java</exclude>
                        <exclude>mondrian/olap4j/FactoryJdbc4Impl.java</exclude>
                    </excludes>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>2.13</version>
                <configuration>
                    <forkMode>always</forkMode>
                    <argLine>-ea -Xms256m -Xmx2048m -XX:MaxPermSize=512m</argLine>
                    <redirectTestOutputToFile>true</redirectTestOutputToFile>
                    <systemProperties>
                        <property>
                            <name>java.awt.headless</name>
                            <value>true</value>
                        </property>
                    </systemProperties>
                </configuration>
            </plugin>
        </plugins>


    </build>


    <dependencies>
        <dependency>
          <groupId>pentaho</groupId>
          <artifactId>mondrian-errors</artifactId>
          <version>${project.version}</version>
        </dependency>

        <dependency>
            <groupId>commons-collections</groupId>
            <artifactId>commons-collections</artifactId>
            <version>3.2</version>

        </dependency>
        <dependency>
            <groupId>commons-dbcp</groupId>
            <artifactId>commons-dbcp</artifactId>
            <version>1.2.1</version>

        </dependency>
        <!--   <dependency>
            <groupId>commons-lang</groupId>
            <artifactId>commons-lang</artifactId>
            <version>2.4</version>

          </dependency> -->
        <!-- <dependency>
          <groupId>commons-io</groupId>
          <artifactId>commons-io</artifactId>
          <version>1.4</version>

        </dependency> -->
        <dependency>
            <groupId>commons-logging</groupId>
            <artifactId>commons-logging</artifactId>
            <version>1.1.1</version>

        </dependency>
        <dependency>
            <groupId>commons-math</groupId>
            <artifactId>commons-math</artifactId>
            <version>1.1</version>

        </dependency>
        <dependency>
            <groupId>commons-pool</groupId>
            <artifactId>commons-pool</artifactId>
            <version>1.2</version>

        </dependency>
        <dependency>
            <groupId>commons-vfs</groupId>
            <artifactId>commons-vfs</artifactId>
            <version>1.0</version>

        </dependency>
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-vfs2</artifactId>
            <version>2.0</version>

        </dependency>
        <!-- <dependency>
          <groupId>net.java.dev.javacc</groupId>
          <artifactId>javacc</artifactId>
          <version>5.0</version>

        </dependency> -->
        <!-- <dependency>
          <groupId>dom4j</groupId>
          <artifactId>dom4j</artifactId>
          <version>1.6.1</version>

        </dependency> -->
        <!--<dependency>-->
        <!--<groupId>javax.validation</groupId>-->
        <!--<artifactId>validation-api</artifactId>-->
        <!--<version>1.0.0.GA</version>-->

        <!--</dependency>-->
        <dependency>
            <groupId>eigenbase</groupId>
            <artifactId>eigenbase-xom</artifactId>
            <version>1.3.1</version>

        </dependency>
        <dependency>
            <groupId>eigenbase</groupId>
            <artifactId>eigenbase-properties</artifactId>
            <version>1.1.2</version>

        </dependency>
        <dependency>
            <groupId>eigenbase</groupId>
            <artifactId>eigenbase-resgen</artifactId>
            <version>1.3.1</version>

        </dependency>
        <!--<dependency>-->
        <!--<groupId>sun</groupId>-->
        <!--<artifactId>jlfgr</artifactId>-->
        <!--<version>1.0</version>-->

        <!--</dependency>-->
        <dependency>
            <groupId>com.sun</groupId>
            <artifactId>rt-jdk1.5</artifactId>
            <version>1.5.0_22</version>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>net.java.openjdk</groupId>
            <artifactId>ctsym-java6</artifactId>
            <version>1.6.0_24</version>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>jsp-api</artifactId>
            <version>2.0</version>

        </dependency>
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>servlet-api</artifactId>
            <version>2.4</version>

        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
            <version>1.7.3</version>
        </dependency>

        <dependency>
            <groupId>org.olap4j</groupId>
            <artifactId>olap4j</artifactId>
            <version>1.2.0-SNAPSHOT</version>
            <optional>true</optional>
        </dependency>

        <dependency>
            <groupId>org.olap4j</groupId>
            <artifactId>olap4j-tck</artifactId>
            <version>1.2.0-SNAPSHOT</version>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>org.olap4j</groupId>
            <artifactId>olap4j-xmla</artifactId>
            <version>1.2.0-SNAPSHOT</version>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>org.olap4j</groupId>
            <artifactId>olap4j-xmlaserver</artifactId>
            <version>0.0.1-SNAPSHOT</version>

        </dependency>
        <dependency>
            <groupId>xalan</groupId>
            <artifactId>xalan</artifactId>
            <version>2.6.0</version>

        </dependency>
        <dependency>
            <groupId>xerces</groupId>
            <artifactId>xercesImpl</artifactId>
            <version>2.9.1</version>

        </dependency>
        <!--<dependency>-->
        <!--<groupId>backport-util-concurrent</groupId>-->
        <!--<artifactId>backport-util-concurrent</artifactId>-->
        <!--<version>3.1</version>-->
        <!--<optional>true</optional>-->
        <!--</dependency>-->
        <!--<dependency>-->
        <!--<groupId>asm</groupId>-->
        <!--<artifactId>asm</artifactId>-->
        <!--<version>3.1</version>-->
        <!--<optional>true</optional>-->
        <!--</dependency>-->
        <!--<dependency>-->
        <!--<groupId>asm</groupId>-->
        <!--<artifactId>asm-commons</artifactId>-->
        <!--<version>3.1</version>-->
        <!--<optional>true</optional>-->
        <!--</dependency>-->
        <!--<dependency>-->
        <!--<groupId>asm</groupId>-->
        <!--<artifactId>asm-util</artifactId>-->
        <!--<version>3.1</version>-->
        <!--<optional>true</optional>-->
        <!--</dependency>-->
        <!--<dependency>-->
        <!--<groupId>retroweaver</groupId>-->
        <!--<artifactId>retroweaver</artifactId>-->
        <!--<version>2.0.7</version>-->
        <!--<optional>true</optional>-->
        <!--</dependency>-->
        <!--<dependency>-->
        <!--<groupId>retroweaver</groupId>-->
        <!--<artifactId>retroweaver-rt</artifactId>-->
        <!--<version>2.0.7</version>-->
        <!--<optional>true</optional>-->
        <!--</dependency>-->
        <!--<dependency>-->
        <!--<groupId>hsqldb</groupId>-->
        <!--<artifactId>hsqldb</artifactId>-->
        <!--<version>1.8.0.10</version>-->
        <!--<scope>test</scope>-->
        <!--</dependency>-->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>3.8.1</version>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-core</artifactId>
            <version>1.0.6</version>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-classic</artifactId>
            <version>1.0.6</version>
            <scope>test</scope>
        </dependency>


        <dependency>
            <groupId>xmlunit</groupId>
            <artifactId>xmlunit</artifactId>
            <version>1.3</version>
            <scope>test</scope>
        </dependency>
        <!--<dependency>-->
        <!--<groupId>monetdb</groupId>-->
        <!--<artifactId>monetdb-jdbc</artifactId>-->
        <!--<version>2.8-SNAPSHOT</version>-->
        <!--<optional>true</optional>-->
        <!--</dependency>-->
        <!--<dependency>-->
        <!--<groupId>pentaho</groupId>-->
        <!--<artifactId>mondrian-data-adventureworks</artifactId>-->
        <!--<version>0.1-SNAPSHOT</version>-->
        <!--<scope>test</scope>-->
        <!--</dependency>-->
        <!--<dependency>-->
        <!--<groupId>pentaho</groupId>-->
        <!--<artifactId>mondrian-data-adventureworks-dw</artifactId>-->
        <!--<version>0.1-SNAPSHOT</version>-->
        <!--<scope>test</scope>-->
        <!--</dependency>-->
        <!--<dependency>-->
        <!--<groupId>pentaho</groupId>-->
        <!--<artifactId>mondrian-data-foodmart</artifactId>-->
        <!--<version>0.9-SNAPSHOT</version>-->
        <!--<scope>test</scope>-->
        <!--</dependency>-->
    </dependencies>

    <!-- <distributionManagement>
        <repository>
            <id>repo.pentaho.org</id>
            <name>repo.pentaho.org-releases</name>
            <url>http://repository.pentaho.org/artifactory/pentaho</url>
        </repository>
        <snapshotRepository>
            <id>repo.pentaho.org</id>
            <name>repo.pentaho.org-snapshots</name>
            <url>http://repository.pentaho.org/artifactory/pentaho</url>
        </snapshotRepository>
    </distributionManagement> -->

    <repositories>
        <repository>
            <releases>
                <enabled>false</enabled>
                <updatePolicy>always</updatePolicy>
                <checksumPolicy>warn</checksumPolicy>
            </releases>
            <snapshots>
                <enabled>true</enabled>
                <updatePolicy>never</updatePolicy>
                <checksumPolicy>fail</checksumPolicy>
            </snapshots>
            <id>repo.pentaho.org</id>
            <name>Pentaho</name>
            <url>http://repository.pentaho.org/artifactory/pentaho</url>
            <layout>default</layout>
        </repository>
    </repositories>

</project>